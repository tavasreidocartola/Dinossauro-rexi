<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dino Runner com poderes</title>
  <style>
    body { margin:0; background:#f7f7f7; font-family:sans-serif; }
    .wrap { max-width:900px; margin:0 auto; padding:16px; }
    canvas { width:100%; border:2px solid #ccc; border-radius:12px; background:#fff; }
    .hud { display:flex; justify-content:space-between; margin-bottom:8px; }
    .badge { padding:4px 8px; border:1px solid #999; border-radius:12px; min-width:120px; text-align:center; }
  </style>
</head>
<body>
<div class="wrap">
  <div class="hud">
    <div>Velocidade: <span id="speed">0</span> | Pontos: <span id="score">0</span> | Recorde: <span id="best">0</span></div>
    <div class="badge" id="powerBadge">Sem poder</div>
  </div>
  <canvas id="game" width="900" height="300"></canvas>
</div>

<script>
(() => {
  const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
  const W=canvas.width,H=canvas.height,groundY=H-40;
  const speedEl=document.getElementById("speed"),scoreEl=document.getElementById("score"),bestEl=document.getElementById("best"),powerBadge=document.getElementById("powerBadge");

  const player={x:80,y:groundY-40,w:36,h:40,vy:0,onGround:true,fly:false};
  const gravity=0.8,jumpVel=-13.5,maxFall=20;
  const obstacles=[],clouds=[],powerups=[];
  let baseSpeed=6,speed=baseSpeed,time=0,score=0;
  let best=Number(localStorage.getItem("runner_best")||0);bestEl.textContent=best;
  const power={type:null,time:0};
  let running=true,gameOver=false,lastTs=0;
  let spawnCooldown=0,cloudCooldown=0,powerCooldown=2;

  function rand(a,b){return Math.random()*(b-a)+a;}
  function clamp(v,a,b){return Math.max(a,Math.min(b,v));}

  function jump(){if(!running||gameOver)return;if(player.fly)return;if(player.onGround){player.vy=jumpVel;player.onGround=false;}}
  window.addEventListener("keydown",e=>{if(gameOver&&e.key==="Enter"){restart();return;}if([" ","ArrowUp","w","W"].includes(e.key)){e.preventDefault();jump();}});
  canvas.addEventListener("pointerdown",()=>{if(gameOver)restart();else jump();});

  function spawnObstacle(){obstacles.push({x:W+10,y:groundY-40,w:20,h:40});}
  function spawnCloud(){clouds.push({x:W+20,y:rand(40,120),w:60,h:20,speed:rand(0.6,1.1)});}
  function spawnPowerup(){
    const r=Math.random();let type;
    if(r<0.25)type="white";else if(r<0.5)type="red";else if(r<0.75)type="blue";else type="copilot";
    powerups.push({x:W+20,y:rand(groundY-100,groundY-40),r:12,type});
  }

  function activatePower(type){power.type=type;power.time=(type==="copilot"?5:4);if(type==="blue")player.fly=true;if(type==="copilot")speed*=0.7;updateBadge();}
  function clearPower(){power.type=null;power.time=0;player.fly=false;updateBadge();}
  function updateBadge(){if(!power.type){powerBadge.textContent="Sem poder";return;}powerBadge.textContent=`${power.type} ${power.time.toFixed(1)}s`; }

  function update(dt){
    if(!running||gameOver)return;
    time+=dt;speed+=((baseSpeed+Math.min(8,time*0.35))-speed)*0.02;
    if(player.fly){player.y+=(groundY-140-player.y)*0.2;player.vy=0;}
    else{player.vy=Math.min(player.vy+gravity,maxFall);player.y+=player.vy;if(player.y+player.h>=groundY){player.y=groundY-player.h;player.vy=0;player.onGround=true;}}
    for(const o of obstacles)o.x-=speed;
    for(let i=obstacles.length-1;i>=0;i--)if(obstacles[i].x+obstacles[i].w<-20)obstacles.splice(i,1);
    for(const c of clouds)c.x-=c.speed;
    for(let i=clouds.length-1;i>=0;i--)if(clouds[i].x+clouds[i].w<-10)clouds.splice(i,1);
    for(const p of powerups)p.x-=speed*0.95;
    for(let i=powerups.length-1;i>=0;i--)if(powerups[i].x+powerups[i].r<-20)powerups.splice(i,1);
    spawnCooldown-=dt;if(spawnCooldown<=0){spawnObstacle();spawnCooldown=rand(0.8,1.2);}
    cloudCooldown-=dt;if(cloudCooldown<=0){spawnCloud();cloudCooldown=rand(1.5,2.5);}
    powerCooldown-=dt;if(powerCooldown<=0){spawnPowerup();powerCooldown=rand(2,4);}
    for(let i=powerups.length-1;i>=0;i--){const p=powerups[i];if(circleRectOverlap(p.x,p.y,p.r,player)){activatePower(p.type);powerups.splice(i,1);}}
    if(power.type){power.time-=dt;if(power.time<=0)clearPower();else updateBadge();}
    score+=speed*dt*10;scoreEl.textContent=Math.floor(score);speedEl.textContent=speed.toFixed(1);
    handleCollisions();
  }

  function handleCollisions(){
    if(["white","blue","copilot"].includes(power.type))return;
    if(power.type==="red"){for(let i=obstacles.length-1;i>=0;i--)if(rectsOverlap(player,obstacles[i]))obstacles.splice(i,1);return;}
    for(const o of obstacles)if(rectsOverlap(player,o))endGame();
  }

  function rectsOverlap(a,b){return a.x<a.x+a.w&&a.x+b.w>a.x&&a.y<a.y+a.h&&a.y+b.h>a.y;}
  function circleRectOverlap(cx,cy,r,rect){const closestX=clamp(cx,rect.x,rect.x+rect.w);const closestY=clamp(cy,rect.y,rect.y+rect.h);const dx=cx-closestX,dy=cy-closestY;return dx*dx+dy*dy<=r*r;}

  function draw(){
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle="#ddd";ctx.fillRect(0,groundY,W,H-groundY);
    ctx.fillStyle="#ccc";for(const c of clouds)ctx.fillRect(c.x,c.y,c.w,c.h);
    for(const p of powerups){ctx.fillStyle=(p.type==="white"?"#fff":p.type==="red"?"#f00":p.type==="blue"?"#00f":"#0f0");ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill();}
    ctx.fillStyle="#070";for(const o of obstacles)ctx.fillRect(o.x,o.y,o.w,o.h);
    ctx.fillStyle=(power.type==="white"?"rgba(0,0,0,0.3)":"#000");ctx.fillRect(player.x,player.y,player.w,player.h);
    if(gameOver){ctx.fillStyle="rgba(255,255,255,0.8)";ctx.fillRect(W/2-100,H/2-40,200,80);ctx.fillStyle="#000";ctx.fillText("GAME OVER",W/2-40,H/2);}
  }

  function endGame(){gameOver=true;running=false;if(score>best){best=score;localStorage.setItem("runner_best",best);bestEl.textContent=best;}}
  function restart(){obstacles.length=0;clouds.length=0;powerups.length=0;player.y=groundY-40;player.vy=0;player.onGround=true;player.fly=false;
